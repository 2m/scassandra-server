<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Priming Prepared Statements - Stubbed Cassandra</title>
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">

  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script>
  <script src="../../js/theme.js"></script>

  <style>
    body {font-size: 90%;}
    pre, code {font-size: 100%;}
    h3, h4, h5, h6 {color: #2980b9; font-weight: 300}
  </style> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Stubbed Cassandra</a>
        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
      <ul class="current">
    
        
            <li class="toctree-l1 ">
                <a class="" href="../../about">About</a>
            </li>
        

    
        
        <span>Java Client</span>
            
                <li class="toctree-l1 ">
                    <a class="" href="../overview">Overview</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../priming-query">Priming Queries</a>
                    
                </li>
            
                <li class="toctree-l1 current">
                    <a class="current" href=".">Priming Prepared Statements</a>
                    
                        <ul>
                        
                            <li class="toctree-l2"><a href="#priming-prepared-statements">Priming Prepared Statements</a></li>
                            
                                <li><a class="toctree-l3" href="#priming-variable-types-without-any-rows">Priming variable types, without any rows</a></li>
                            
                                <li><a class="toctree-l3" href="#priming-variable-types-and-rows-with-column-types">Priming variable types and rows with column types</a></li>
                            
                                <li><a class="toctree-l3" href="#priming-errors">Priming errors</a></li>
                            
                                <li><a class="toctree-l3" href="#verifying-prepared-statement-execution">Verifying prepared statement execution</a></li>
                            
                                <li><a class="toctree-l3" href="#resetting-your-primes">Resetting your primes</a></li>
                            
                        
                        </ul>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../priming-delays">Priming Delays</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../priming-collections">Priming Collections</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../hamcrest-matchers">Hamcest Matchers</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../activity">Activity Verification</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../column-types">Column Types</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../troubleshooting">Troubleshooting</a>
                    
                </li>
            
        

    
        
        <span>Standlone</span>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../standalone/overview">Overview</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../standalone/activity">Activity Verification</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../standalone/priming-query">Priming Queries</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../standalone/priming-ps">Priming Prepared Statements</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../standalone/priming-cluster-name">Priming Cluster Name</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../standalone/priming-errors">Priming Errors</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../standalone/using-python">Python Driver</a>
                    
                </li>
            
        

    
</ul>

      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="icon icon-reorder"></i>
        <a href="../.."></a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    <li>Priming Prepared Statements</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              <h2 id="priming-prepared-statements">Priming Prepared Statements</h2>
<p>You need to prime any prepared statements your application is going to use before your application prepares the statement,
not just before it executes it. So if your application prepares them on startup you should prime Scassandra before you
start your application.</p>
<p>This is because when your application prepares the statement Cassandra responds with the types of each of the variable's (?s)
type information. Drivers use this information to validate your execution of the prepared statement without sending it to
Cassandra. So if you do not prime before your application prepares the statement Scassandra can only guess what the types are,
 and it defaults them all to varchar.</p>
<p>You build priming requests with the PrimingRequestBuilder. The builder takes the following:</p>
<ul>
<li><strong>Query</strong> - The only mandatory property e.g "select * from person where name = ?"</li>
<li><strong>Consistency</strong> - Defaults to all consistencies. Can override to ONE, TWO, LOCAL_QUORUM etc</li>
<li><strong>Result</strong> - Defaults to Success. Other values are Read timeout exception, Write timeout exception and Unavailable exception</li>
<li><strong>ColumnTypes</strong> - All columns default to Varchar. You'll need to override this.</li>
<li><strong>VariableTypes</strong> - This is the type of each of the? in the prepared statement. All variable types default to Varchar. You'll need to override this.</li>
</ul>
<h4 id="priming-variable-types-without-any-rows">Priming variable types, without any rows</h4>
<p>This primes a prepared statement with two variables, where the first is a varchar and the second is an int. You specify
the variable types in the order they appear in the prepared statement text.</p>
<p>Assuming you have the following static imports:</p>
<pre><code class="java">import static org.scassandra.http.client.types.ColumnMetadata.*;
import static org.scassandra.cql.PrimitiveType.*;
import static org.scassandra.cql.MapType.*;
import static org.scassandra.cql.SetType.*;
import static org.scassandra.cql.ListType.*;


</code></pre>

<p>This is how to prime a prepared statement:</p>
<pre><code class="java">PrimingRequest preparedStatementPrime = PrimingRequest.preparedStatementBuilder()
    .withQuery(&quot;insert into person(first_name, age) values (?,?)&quot;)
    .withVariableTypes(VARCHAR, INT)
    .build();
primingClient.primePreparedStatement(preparedStatementPrime);
</code></pre>

<p>As this is an insert then you don't need to specify any rows to return.</p>
<h4 id="priming-variable-types-and-rows-with-column-types">Priming variable types and rows with column types</h4>
<p>This is about as complicated as it gets. You want to prime the variable types of the prepared statement as well as
return rows with column types other than varchat.</p>
<pre><code class="java">Map&lt;String, ? extends  Object&gt; row = ImmutableMap.of(
        &quot;first_name&quot;, &quot;Chris&quot;,
        &quot;last_name&quot;, &quot;Batey&quot;,
        &quot;age&quot;, 29);
PrimingRequest preparedStatementPrime = PrimingRequest.preparedStatementBuilder()
        .withQuery(&quot;select * from person where first_name = ?&quot;)
        .withVariableTypes(VARCHAR)
        .withColumnTypes(column(&quot;age&quot;, INT)
        .withRows(row)
        .build();
primingClient.primePreparedStatement(preparedStatementPrime);
</code></pre>

<h4 id="priming-errors">Priming errors</h4>
<p>Works the same as with queries. See <a href="../../{{ site.baseurl }}/priming-query">priming queries</a></p>
<h4 id="verifying-prepared-statement-execution">Verifying prepared statement execution</h4>
<p>See the <a href="../../{{ site.baseurl }}/hamcrest-matchers">Hamcrest Matchers</a> page.</p>
<h4 id="resetting-your-primes">Resetting your primes</h4>
<p>No need to restart Scassandra. You can either remove all your prepared statement primes or all primes (including prepared statement primes).</p>
<pre><code class="java">primingClient.clearAllPrimes();
primingClient.clearPreparedPrimes();

</code></pre>


            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../priming-delays" class="btn btn-neutral float-right" title="Priming Delays"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../priming-query" class="btn btn-neutral" title="Priming Queries"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
    <!-- Copyright etc -->
    </p>
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
        
      <span><a href="../priming-query" style="color: #fcfcfc;">&laquo; Previous</a></span>
      <span style="margin-left: 15px"><a href="../priming-delays" style="color: #fcfcfc">Next &raquo;</a></span>
    </span>
</div>
</body>
</html>